<html>
	<head>
		<title>Rock Paper Roshambo in JavaScript </title>
	</head>
	<body onload="updateDisplayedScore()">
	
		<p>Which one will it be?</p>
		<a href="#" onclick="playRoshambo('rock')">rock</a>
		<a href="#" onclick="playRoshambo('paper')">paper</a>
		<a href="#" onclick="playRoshambo('scissors')">scissors</a>
		<div id="results">&nbsp;</div>
		
	    <p>Here is the running score:</p>
		Wins:   <span id="wins"></span> 
		Losses: <span id="losses"></span> 
		Ties:   <span id="ties"></span> 

<script>

updateServer = function(postfix){
	console.log(result);
	let url = "http://localhost:8080/score/increase" + postfix;
	console.log(url);
	
	let ajaxRequest = new XMLHttpRequest();
	ajaxRequest.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200) {
	    console.log(this.responseText);
	  }
	};
	
	ajaxRequest.open("GET", url, true);
	ajaxRequest.send();

}

addGameSummary = function(json){
	console.log(json);
	let url = "http://localhost:8080/gamesummary";
	console.log(url);
	
	 fetch(url, {
         method: 'POST',
         headers: {
             'Content-Type': 'application/json'
         },
         body: json
     })
     .then(response => {
         if (!response.ok) {
             throw new Error('Network response was not ok');
         }
         return response.json();
     })
     .then(data => {
         console.log('Game summary added successfully:', data);
         // Perform any other actions after the successful addition of the game summary
     })
     .catch(error => {
         console.error('Error adding game summary:', error);
         // Handle error scenarios, if required
     });

}


updateDisplayedScore = function(clientGesture){
    // @CrossOrigin CORS support on REST API required for this
	let url = "http://localhost:8080/score"
	let ajaxRequest = new XMLHttpRequest();
	ajaxRequest.open("GET", url, true);
	ajaxRequest.send();
	ajaxRequest.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200) {
			console.log(this.responseText);
			let score = JSON.parse(this.responseText);
			document.getElementById("wins").innerHTML = score.wins;
			document.getElementById("losses").innerHTML = score.losses;
			document.getElementById("ties").innerHTML = score.ties;
		}
	}; // end onreadystatechange
}

playRoshambo = function(clientGesture){

	if (clientGesture=='paper') { 
	  result = "lose";
	  updateServer("wins");
	  addGameSummary("{\"clientGesture\":\"PAPER\",\"serverGesture\":\"ROCK\",\"result\":\"WIN\",\"timePlayed\":\"2010-05-12T04:00:00.000+0000\"}")
	} // end if

	if (clientGesture=='scissors') {
	  result = "loss";
	  updateServer("losses");
	  addGameSummary("{\"clientGesture\":\"SCISSORS\",\"serverGesture\":\"ROCK\",\"result\":\"LOSS\",\"timePlayed\":\"2010-05-12T04:00:00.000+0000\"}")

	} // end if

	if (clientGesture=='rock') {
	  result = "tie";
	  updateServer("ties");
	  addGameSummary("{\"clientGesture\":\"ROCK\",\"serverGesture\":\"ROCK\",\"result\":\"TIE\",\"timePlayed\":\"2010-05-12T04:00:00.000+0000\"}")

	} // end if

	document.getElementById('results').innerHTML = result;
	updateDisplayedScore();

} // end method
</script>


	</body>
</html>